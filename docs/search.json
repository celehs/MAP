[{"path":"https://celehs.github.io/MAP/articles/MAP.html","id":"overview","dir":"Articles","previous_headings":"","what":"Overview","title":"MAP: Multimodal Automated Phenotyping","text":"Electronic health records linked biorepositories powerful platform translational studies. major bottleneck exists ability phenotype patients accurately efficiently. objective study develop automated high-throughput phenotyping method integrating International Classification Diseases (ICD) codes narrative data extracted using natural language processing (NLP).developed mapping method automatically identifying relevant ICD NLP concepts specific phenotype leveraging Unified Medical Language System. Along health care utilization, aggregated ICD NLP counts jointly analyzed fitting ensemble latent mixture models. multimodal automated phenotyping (MAP) algorithm yields predicted probability phenotype patient threshold classifying participants phenotype yes/. algorithm validated using labeled data 16 phenotypes biorepository tested independent cohort phenome-wide association studies (PheWAS) 2 single nucleotide polymorphisms known associations.","code":""},{"path":"https://celehs.github.io/MAP/articles/MAP.html","id":"identifying-the-main-icd-and-nlp-features-for-phenotypes","dir":"Articles","previous_headings":"","what":"Identifying the main ICD and NLP features for phenotypes","title":"MAP: Multimodal Automated Phenotyping","text":"define target phenotype, first determine main ICD code associated phenotype. code either specified researcher chosen PheWAS code catalog use corresponding ICD mapping. PheWAS catalog groups ICD codes clinically relevant categories, bacterial pneumonia, includes different types pneumonia linked specific code. aggregate multiple higher-level PheWAS codes represent broader categories, like diabetes, includes type 1 type 2 diabetes. selected ICD codes, aggregate represent main ICD feature calculate total count main ICD feature dataset. also map ICD-10 codes ICD-9 using General Equivalence Mapping provided Centers Medicare & Medicaid Services. ICD-9 code counted per day minimize impact dual coding. phenotype NLP feature, identify medical concepts mapping relevant clinical terms unique identifiers (CUIs) Unified Medical Language System (UMLS). mapping process involves identifying CUIs three steps: directly mapping ICD-9 codes CUIs, mapping ICD-9 descriptions CUIs exact matches, mapping phenotype descriptions CUIs exact matches. Although first two mapping steps usually yield identical lists, second step can sometimes produce larger list due potential single ICD-9 description map multiple concepts. compiled list CUIs represents PheWAS code. narrative text notes participants processed next. Using CUI list PheWAS code, count mention clinical terms linked CUIs. phenotype defined multiple PheWAS codes, sum counts get overall NLP count phenotype. Narrative Information Linear Extraction (NILE) system used extract concepts. previous studies, know NLP features extracted consistent regardless NLP platform used. also adjust health care utilization counting total number narrative notes patient. count serves proxy health care utilization MAP algorithm. Moreover, log-transform counts features enhance model robustness predictive accuracy.","code":""},{"path":"https://celehs.github.io/MAP/articles/MAP.html","id":"unsupervised-map-prediction","dir":"Articles","previous_headings":"","what":"Unsupervised MAP prediction","title":"MAP: Multimodal Automated Phenotyping","text":"Using data ICD NLP counts log-transformed versions, fit mixture models feature estimate likelihood patient phenotype. use Poisson normal mixture models depending provides better fit observed data. models help adjust health care utilization noise affect feature predictions. predict likelihood phenotype, compute posterior probabilities patient using fitted models. estimate phenotyping prevalence averaging probabilities. Finally, classify participants phenotype based whether predicted probability exceeds average prevalence threshold.","code":""},{"path":"https://celehs.github.io/MAP/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Thomas Charlon. Author, maintainer. Chuan Hong. Author. Jiehuan Sun. Author. Katherine Liao. Author. Sheng Yu. Author. Tianxi Cai. Author. PARSE Health. Author.           <https://parse-health.org> CELEHS. Author.           <https://celehs.hms.harvard.edu>","code":""},{"path":"https://celehs.github.io/MAP/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Charlon T, Hong C, Sun J, Liao K, Yu S, Cai T, PARSE Health, CELEHS (2025). MAP: Multimodal Automated Phenotyping. R package version 1.0.0, https://celehs.github.io/MAP/, https://github.com/celehs/MAP.","code":"@Manual{,   title = {MAP: Multimodal Automated Phenotyping},   author = {Thomas Charlon and Chuan Hong and Jiehuan Sun and Katherine Liao and Sheng Yu and Tianxi Cai and {PARSE Health} and {CELEHS}},   year = {2025},   note = {R package version 1.0.0, https://celehs.github.io/MAP/},   url = {https://github.com/celehs/MAP}, }"},{"path":[]},{"path":"https://celehs.github.io/MAP/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Multimodal Automated Phenotyping","text":"Install stable version CRAN: Install development version GitHub:","code":"install.packages(\"MAP\") # install.packages(\"remotes\") remotes::install_github(\"celehs/MAP\")"},{"path":"https://celehs.github.io/MAP/index.html","id":"overview","dir":"","previous_headings":"","what":"Overview","title":"Multimodal Automated Phenotyping","text":"Electronic health records (EHR) linked biorepositories powerful platform translational studies. major bottleneck exists ability phenotype patients accurately efficiently. Towards end, developed automated high-throughput phenotyping method integrating International Classification Diseases (ICD) codes narrative data extracted using natural language processing (NLP). Specifically, proposed method, called MAP (Map Automated Phenotyping algorithm), fits ensemble latent mixture models aggregated ICD NLP counts along healthcare utilization. MAP algorithm yields predicted probability phenotype patient threshold classifying subjects phenotype yes/(See Katherine P. Liao, et al. (2019) doi:10.1093/jamia/ocz066.).","code":""},{"path":"https://celehs.github.io/MAP/index.html","id":"identifying-the-main-icd-and-nlp-features-for-phenotypes","dir":"","previous_headings":"","what":"Identifying the main ICD and NLP features for phenotypes","title":"Multimodal Automated Phenotyping","text":"define target phenotype, first determine main ICD code associated phenotype. code either specified researcher chosen PheWAS code catalog use corresponding ICD mapping. PheWAS catalog groups ICD codes clinically relevant categories, bacterial pneumonia, includes different types pneumonia linked specific code. aggregate multiple higher-level PheWAS codes represent broader categories, like diabetes, includes type 1 type 2 diabetes. selected ICD codes, aggregate represent main ICD feature calculate total count main ICD feature dataset. also map ICD-10 codes ICD-9 using General Equivalence Mapping provided Centers Medicare & Medicaid Services. ICD-9 code counted per day minimize impact dual coding. phenotype NLP feature, identify medical concepts mapping relevant clinical terms unique identifiers (CUIs) Unified Medical Language System (UMLS). mapping process involves identifying CUIs three steps: directly mapping ICD-9 codes CUIs, mapping ICD-9 descriptions CUIs exact matches, mapping phenotype descriptions CUIs exact matches. Although first two mapping steps usually yield identical lists, second step can sometimes produce larger list due potential single ICD-9 description map multiple concepts. compiled list CUIs represents PheWAS code. narrative text notes participants processed next. Using CUI list PheWAS code, count mention clinical terms linked CUIs. phenotype defined multiple PheWAS codes, sum counts get overall NLP count phenotype. Narrative Information Linear Extraction (NILE) system used extract concepts. previous studies, know NLP features extracted consistent regardless NLP platform used. also adjust health care utilization counting total number narrative notes patient. count serves proxy health care utilization MAP algorithm. Moreover, log-transform counts features enhance model robustness predictive accuracy.","code":""},{"path":"https://celehs.github.io/MAP/index.html","id":"unsupervised-map-prediction","dir":"","previous_headings":"","what":"Unsupervised MAP prediction","title":"Multimodal Automated Phenotyping","text":"Using data ICD NLP counts log-transformed versions, fit mixture models feature estimate likelihood patient phenotype. use Poisson normal mixture models depending provides better fit observed data. models help adjust health care utilization noise affect feature predictions. predict likelihood phenotype, compute posterior probabilities patient using fitted models. estimate phenotyping prevalence averaging probabilities. Finally, classify participants phenotype based whether predicted probability exceeds average prevalence threshold.","code":""},{"path":"https://celehs.github.io/MAP/index.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Multimodal Automated Phenotyping","text":"Liao, K. P., Sun, J., Cai, T. ., Link, N., Hong, C., Huang, J., Huffman, J. E., Gronsbell, J., Zhang, Y., Ho, Y. L., Castro, V., Gainer, V., Murphy, S. N., O’Donnell, C. J., Gaziano, J. M., Cho, K., Szolovits, P., Kohane, . S., Yu, S., & Cai, T. (2019). High-throughput multimodal automated phenotyping (MAP) application PheWAS. Journal American Medical Informatics Association : JAMIA, 26(11), 1255–1262. https://doi.org/10.1093/jamia/ocz066","code":""},{"path":"https://celehs.github.io/MAP/reference/MAP.html","id":null,"dir":"Reference","previous_headings":"","what":"MAP algorithm — MAP","title":"MAP algorithm — MAP","text":"Main function perform MAP algorithm calculate predicted probabilities positive phenotype patient based NLP ICD counts adjusted healthcare utilization. large number patients (>50k) may take long compute, subset_sample parameter provided perform fit subset patients project remaining. subset_sample_size controls maximum number patients perform fit.","code":""},{"path":"https://celehs.github.io/MAP/reference/MAP.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"MAP algorithm — MAP","text":"","code":"MAP(   mat = NULL,   note = NULL,   yes.con = FALSE,   full.output = FALSE,   subset_sample = FALSE,   subset_sample_size = 5000,   verbose = TRUE )"},{"path":"https://celehs.github.io/MAP/reference/MAP.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"MAP algorithm — MAP","text":"mat Count data (sparse matrix). One columns ICD data name ICD. note Note count (sparse matrix) indicating healthcare utilization. yes.con logical variable indicating concomitant desired. used now. full.output logical variable indicating full outputs desired. subset_sample Logical, perform fit subset patients project remaining. subset_sample_size subset_sample TRUE, number patients perform fit (default 50k). verbose Print model information","code":""},{"path":"https://celehs.github.io/MAP/reference/MAP.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"MAP algorithm — MAP","text":"Returns list following objects: scores Indicates predicted probabilities. cut.MAP cutoff value can used derive binary         phenotypes.","code":""},{"path":"https://celehs.github.io/MAP/reference/MAP.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"MAP algorithm — MAP","text":"High-throughput Multimodal Automated Phenotyping (MAP) Application PheWAS. Katherine P. Liao, Jiehuan Sun, Tianrun . Cai, Nicholas Link, Chuan Hong, Jie Huang, Jennifer Huffman, Jessica Gronsbell, Yichi Zhang, Yuk-Lam Ho, Victor Castro, Vivian Gainer, Shawn Murphy, Christopher J. O’Donnell, J. Michael Gaziano, Kelly Cho, Peter Szolovits, Isaac Kohane, Sheng Yu, Tianxi Cai VA Million Veteran Program (2019) <doi:10.1101/587436>.","code":""},{"path":"https://celehs.github.io/MAP/reference/MAP.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"MAP algorithm — MAP","text":"","code":"## simulate data to test the algorithm n = 400 ICD = c(rpois(n/4,10), rpois(n/4,1), rep(0,n/2) ) NLP = c(rpois(n/4,10), rpois(n/4,1), rep(0,n/2) ) mat = Matrix(data=cbind(ICD,NLP),sparse = TRUE) note = Matrix(rpois(n,10)+5,ncol=1,sparse = TRUE) res = MAP(mat = mat,  note=note) #> #######################  #> MAP only considers patients who have note count data and #>         at least one non-missing variable #> #### #> Here is a summary of the input data: #> Total number of patients: 400  #>   ICD NLP note Freq #> 1 YES YES  YES  400 #> ####  head(res$scores) #> 6 x 1 sparse Matrix of class \"dgCMatrix\" #>                #> [1,] 0.9384403 #> [2,] 0.9662253 #> [3,] 0.9998453 #> [4,] 0.9999777 #> [5,] 0.9999809 #> [6,] 0.6284407 res$cut.MAP #> [1] 0.3395483"},{"path":"https://celehs.github.io/MAP/reference/compound.html","id":null,"dir":"Reference","previous_headings":"","what":"Assignment pipe — %<>%","title":"Assignment pipe — %<>%","text":"Pipe object forward function call expression update `lhs` object resulting value. Magrittr imported function, see details examples magrittr package.","code":""},{"path":"https://celehs.github.io/MAP/reference/compound.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Assignment pipe — %<>%","text":"lhs object serves initial value target. rhs function call using magrittr semantics.","code":""},{"path":"https://celehs.github.io/MAP/reference/compound.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Assignment pipe — %<>%","text":"None, used update value lhs.","code":""},{"path":"https://celehs.github.io/MAP/reference/exposition.html","id":null,"dir":"Reference","previous_headings":"","what":"Exposition pipe — %$%","title":"Exposition pipe — %$%","text":"Expose names `lhs` `rhs` expression. Magrittr imported function, see details examples magrittr package.","code":""},{"path":"https://celehs.github.io/MAP/reference/exposition.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Exposition pipe — %$%","text":"lhs list, environment, data.frame. rhs expression names lhs available.","code":""},{"path":"https://celehs.github.io/MAP/reference/exposition.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Exposition pipe — %$%","text":"Result rhs applied one several names lhs.","code":""},{"path":"https://celehs.github.io/MAP/reference/phecode.cuis.list.html","id":null,"dir":"Reference","previous_headings":"","what":"MAP dictionary — phecode.cuis.list","title":"MAP dictionary — phecode.cuis.list","text":"MAP dictionary maps phecode CUIs","code":""},{"path":"https://celehs.github.io/MAP/reference/phecode.cuis.list.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"MAP dictionary — phecode.cuis.list","text":"","code":"phecode.cuis.list"},{"path":"https://celehs.github.io/MAP/reference/phecode.cuis.list.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"MAP dictionary — phecode.cuis.list","text":"list 1866","code":""},{"path":"https://celehs.github.io/MAP/reference/phecode.cuis.list.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"MAP dictionary — phecode.cuis.list","text":"","code":"head(phecode.cuis.list) #> $`008_` #>  [1] \"C0008354\" \"C0343372\" \"C0275976\" \"C0343375\" \"C0343376\" \"C0343377\" #>  [7] \"C0030528\" \"C0016479\" \"C0002438\" \"C1363999\" \"C0152501\" \"C0023886\" #> [13] \"C0152502\" \"C0152503\" \"C1318565\" \"C0152505\" \"C0152506\" \"C1299919\" #> [19] \"C0411268\" \"C0343398\" \"C0276774\" \"C0152518\" \"C0152519\" \"C1279224\" #> [25] \"C0595979\" \"C0013369\" \"C0152522\" \"C0152942\" \"C0152945\" \"C0041466\" #> [31] \"C0152485\" \"C0036114\" \"C0152487\" \"C0152492\" \"C0029826\" \"C0036117\" #> [37] \"C0013371\" \"C0302358\" \"C0302359\" \"C0302360\" \"C0302361\" \"C0152493\" #> [43] \"C0152498\" \"C0038159\" \"C1739094\" \"C0275590\" \"C0152496\" \"C0152497\" #> [49] \"C0374921\" \"C0152511\" \"C0276058\" \"C0152513\" \"C0489951\" \"C0038157\" #> [55] \"C0152515\" \"C0275982\" \"C0238528\" \"C0374931\" \"C0374932\" \"C0152516\" #> [61] \"C0341558\" \"C0343380\" \"C0343379\" \"C0343382\" \"C0343381\" \"C0494024\" #> [67] \"C0494025\" \"C0152517\" \"C0347854\" \"C0276162\" \"C0374933\" \"C0374934\" #> [73] \"C1611187\" \"C0374936\" \"C0374937\" \"C0348098\" \"C0489952\" \"C0152500\" #> [79] \"C0004692\" \"C0017536\" \"C0010418\" \"C0152507\" \"C0009187\" \"C0042708\" #> [85] \"C0178238\" #>  #> $`008_5` #>  [1] \"C0041466\" \"C0152485\" \"C0036114\" \"C0152487\" \"C0152492\" \"C0029826\" #>  [7] \"C0036117\" \"C0013371\" \"C0302358\" \"C0302359\" \"C0302360\" \"C0302361\" #> [13] \"C0152493\" \"C0152498\" \"C0038159\" \"C1739094\" \"C0275590\" \"C0152496\" #> [19] \"C0152497\" \"C0374921\" \"C0152511\" \"C0276058\" \"C0152513\" \"C0489951\" #> [25] \"C0038157\" \"C0152515\" \"C0275982\" \"C0238528\" \"C0374931\" \"C0374932\" #> [31] \"C0152516\" \"C0341558\" \"C0343380\" \"C0343379\" \"C0343382\" \"C0343381\" #> [37] \"C0494024\" \"C0494025\" #>  #> $`008_51` #> [1] \"C0341558\" \"C0343380\" \"C0343379\" \"C0343382\" \"C0343381\" \"C0494024\" #>  #> $`008_52` #> [1] \"C0494025\" #>  #> $`008_6` #>  [1] \"C0152517\" \"C0347854\" \"C0276162\" \"C0374933\" \"C0374934\" \"C1611187\" #>  [7] \"C0374936\" \"C0374937\" \"C0348098\" \"C0489952\" \"C0042708\" #>  #> $`008_7` #> [1] \"C0152500\" \"C0004692\" \"C0017536\" \"C0010418\" \"C0152507\" #>  tail(phecode.cuis.list) #> $`990_` #>  [1] \"C0156153\" \"C0156270\" \"C0157088\" \"C0157089\" \"C0157090\" \"C0157091\" #>  [7] \"C0160814\" \"C0034525\" \"C0481248\" \"C0260497\" #>  #> $`994_` #> [1] \"C0242966\" \"C1719676\" \"C1719677\" \"C0243026\" \"C1719672\" \"C0036983\" \"C0036690\" #>  #> $`994_1` #> [1] \"C0242966\" \"C1719676\" \"C1719677\" #>  #> $`994_2` #> [1] \"C0243026\" \"C1719672\" \"C0036983\" \"C0036690\" #>  #> $`994_21` #> [1] \"C0036983\" #>  #> $`996_` #> [1] \"C0274344\" \"C0161771\" \"C0161805\" \"C0496137\" #>"},{"path":"https://celehs.github.io/MAP/reference/pipe.html","id":null,"dir":"Reference","previous_headings":"","what":"Pipe — %>%","title":"Pipe — %>%","text":"Pipe object forward function call expression. Magrittr imported function, see details examples magrittr package.","code":""},{"path":"https://celehs.github.io/MAP/reference/pipe.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Pipe — %>%","text":"lhs value magrittr placeholder. rhs function call using magrittr semantics.","code":""},{"path":"https://celehs.github.io/MAP/reference/pipe.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Pipe — %>%","text":"Result rhs applied lhs, see details magrittr package.","code":""}]
