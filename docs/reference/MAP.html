<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>MAP algorithm — MAP • MAP</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="MAP algorithm — MAP"><meta name="description" content="Main function to perform MAP algorithm to calculate predicted
probabilities of positive phenotype for each patient
based on NLP and ICD counts adjusted for healthcare utilization.
For large number of patients (&amp;gt;50k) it may take very long to compute,
so a subset_sample parameter is provided to perform the fit on a subset of
patients and project the remaining. The subset_sample_size controls the
maximum number of patients on which to perform the fit."><meta property="og:description" content="Main function to perform MAP algorithm to calculate predicted
probabilities of positive phenotype for each patient
based on NLP and ICD counts adjusted for healthcare utilization.
For large number of patients (&amp;gt;50k) it may take very long to compute,
so a subset_sample parameter is provided to perform the fit on a subset of
patients and project the remaining. The subset_sample_size controls the
maximum number of patients on which to perform the fit."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="inverse" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MAP</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/MAP.html">Multimodal Automated Phenotyping</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/example.html">Example</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://celehs.github.io">CELEHS Software</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>MAP algorithm</h1>
      <small class="dont-index">Source: <a href="https://github.com/celehs/MAP/blob/HEAD/R/MAP.R" class="external-link"><code>R/MAP.R</code></a></small>
      <div class="d-none name"><code>MAP.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Main function to perform MAP algorithm to calculate predicted
probabilities of positive phenotype for each patient
based on NLP and ICD counts adjusted for healthcare utilization.
For large number of patients (&gt;50k) it may take very long to compute,
so a subset_sample parameter is provided to perform the fit on a subset of
patients and project the remaining. The subset_sample_size controls the
maximum number of patients on which to perform the fit.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">MAP</span><span class="op">(</span></span>
<span>  mat <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  note <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  yes.con <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  full.output <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  subset_sample <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  subset_sample_size <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-mat">mat<a class="anchor" aria-label="anchor" href="#arg-mat"></a></dt>
<dd><p>Count data (sparse matrix). One of the columns has to be ICD
data with name being ICD.</p></dd>


<dt id="arg-note">note<a class="anchor" aria-label="anchor" href="#arg-note"></a></dt>
<dd><p>Note count (sparse matrix) indicating healthcare utilization.</p></dd>


<dt id="arg-yes-con">yes.con<a class="anchor" aria-label="anchor" href="#arg-yes-con"></a></dt>
<dd><p>A logical variable indicating if concomitant is desired. Not
used for now.</p></dd>


<dt id="arg-full-output">full.output<a class="anchor" aria-label="anchor" href="#arg-full-output"></a></dt>
<dd><p>A logical variable indicating if full outputs are
desired.</p></dd>


<dt id="arg-subset-sample">subset_sample<a class="anchor" aria-label="anchor" href="#arg-subset-sample"></a></dt>
<dd><p>Logical, perform fit on a subset of patients and
project remaining.</p></dd>


<dt id="arg-subset-sample-size">subset_sample_size<a class="anchor" aria-label="anchor" href="#arg-subset-sample-size"></a></dt>
<dd><p>If subset_sample TRUE, number of patients on which
to perform the fit (default 50k).</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Print model information</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns a list with following objects:</p>
<dl><dt>scores</dt>
<dd><p>Indicates predicted probabilities.</p></dd>

        <dt>cut.MAP</dt>
<dd><p>The cutoff value that can be used to derive binary
        phenotypes.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>High-throughput Multimodal Automated Phenotyping (MAP) with
Application to PheWAS. Katherine P. Liao, Jiehuan Sun,
Tianrun A. Cai, Nicholas Link, Chuan Hong, Jie Huang, Jennifer Huffman,
Jessica Gronsbell, Yichi Zhang, Yuk-Lam Ho, Victor Castro, Vivian Gainer,
Shawn Murphy, Christopher J. O’Donnell, J. Michael Gaziano, Kelly Cho,
Peter Szolovits, Isaac Kohane, Sheng Yu, and Tianxi Cai
with the VA Million Veteran Program (2019) &lt;doi:10.1101/587436&gt;.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## simulate data to test the algorithm</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">=</span> <span class="fl">400</span></span></span>
<span class="r-in"><span><span class="va">ICD</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">n</span><span class="op">/</span><span class="fl">4</span>,<span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">n</span><span class="op">/</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">NLP</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">n</span><span class="op">/</span><span class="fl">4</span>,<span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">n</span><span class="op">/</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mat</span> <span class="op">=</span> <span class="fu">Matrix</span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">ICD</span>,<span class="va">NLP</span><span class="op">)</span>,sparse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">note</span> <span class="op">=</span> <span class="fu">Matrix</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">n</span>,<span class="fl">10</span><span class="op">)</span><span class="op">+</span><span class="fl">5</span>,ncol<span class="op">=</span><span class="fl">1</span>,sparse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">=</span> <span class="fu">MAP</span><span class="op">(</span>mat <span class="op">=</span> <span class="va">mat</span>,  note<span class="op">=</span><span class="va">note</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ####################### </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MAP only considers patients who have note count data and</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         at least one non-missing variable</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ####</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Here is a summary of the input data:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total number of patients: 400 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ICD NLP note Freq</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 YES YES  YES  400</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> #### </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">scores</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 x 1 sparse Matrix of class "dgCMatrix"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 0.9384403</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 0.9662253</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 0.9998453</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,] 0.9999777</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5,] 0.9999809</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6,] 0.6284407</span>
<span class="r-in"><span><span class="va">res</span><span class="op">$</span><span class="va">cut.MAP</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.3395483</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Charlon, Chuan Hong, Jiehuan Sun, Katherine Liao, Sheng Yu, Tianxi Cai, PARSE Health, CELEHS.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

